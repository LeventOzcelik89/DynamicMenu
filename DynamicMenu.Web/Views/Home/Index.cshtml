<!-- Menü Tablosu Sayfası -->
<div class="page" id="menu-list" data-page="menu-list">
    <header>
        <h1>Menü Yönetimi</h1>
    </header>
    <main>
        <div class="action-buttons top-buttons">
            <button class="action-button" id="new-menu">
                <i class="fas fa-plus"></i>
                <span>Yeni Menü Ekle</span>
            </button>
        </div>

        <div class="data-table-container">
            <table class="table table-bordered table-hover align-middle" id="tbl">
                <thead class="table-light">
                    <tr>
                        <th>Adı</th>
                        <th>Açıklama</th>
                        <th>Aktif mi</th>
                        <th>Menü Tipi</th>
                        <th>Oluşturma Tarihi</th>
                        <th>Düzenleme Tarihi</th>
                        <th>Menü Grupları</th>
                        <th style="width: 120px;">İşlemler</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

    </main>
</div>

<script type="text/template" id="tblRow">

    <tr>
        <td>{{data.Name}}</td>
        <td>{{data.Description}}</td>
        <td>
            <span class="badge bg-{{data.IsActive == true ? 'success' : 'danger'}}">{{data.IsActive == true ? 'Aktif' : 'Pasif'}}</span>
        </td>
            <td>{{data.MenuType}}</td>
            <td>{{data.CreatedDate == null ? '-' : new Date(data.CreatedDate).toLocaleString('tr-TR')}}</td>
            <td>{{data.ModifiedDate == null ? '-' : new Date(data.ModifiedDate).toLocaleString('tr-TR')}}</td>
            <td>{{data.Menus.map(function(item){ return '<a href="Menu/Update?MenuGroupId=' + data.Id + '&MenuId=' + item.Id + '" class="btn btn-sm btn-info">' + item.Name + '</a>'; }).join(''); }}</td>
            @* <td>{{data.menus.map(function(item){ return '<span class="badge bg-success menuTarget' + item.menuTarget + '">' + item.name + '</span>'; }).join(''); }}</td> *@
            <td>
                <button type="button" class="btn btn-sm btn-primary edit-menu-btn"
                        data-id="{{data.Id}}" data-name="{{data.Name}}" data-description="{{data.Description}}" data-aktif="{{data.IsActive}}" data-menutype="{{data.MenuType}}">
                    <i class="fa fa-pencil"></i> Düzenle
                </button>
                <a href="MenuGroup/Update?menugroupId={{data.Id}}" class="btn btn-sm btn-info"><i class="fa fa-wrench"></i> Yönetim</a>
            </td>
        </tr>

</script>

<!-- Menü Düzenle Modal -->
<div class="modal fade" id="editMenuModal" tabindex="-1" aria-labelledby="editMenuModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editMenuModalLabel">Menü Düzenle</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
            </div>
            <div class="modal-body">
                <form id="editMenuForm">
                    <div class="mb-3">
                        <label for="menuText" class="form-label">Menü Text</label>
                        <input type="text" class="form-control" id="menuText" name="menuText" required />
                    </div>
                    <div class="mb-3">
                        <label for="menuIcon" class="form-label">Menü İkonu</label>
                        <input type="text" class="form-control" id="menuIcon" name="menuIcon" />
                    </div>
                    <div class="mb-3">
                        <label for="menuKey" class="form-label">Menü Key</label>
                        <input type="text" class="form-control" id="menuKey" name="menuKey" required />
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="isNewMenu" name="isNewMenu" />
                        <label class="form-check-label" for="isNewMenu">Yeni mi?</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Vazgeç</button>
                <button type="button" class="btn btn-primary" id="saveMenuBtn">Kaydet</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {

    <script type="text/javascript">

        var page = {

            tbl: null,
            ready: function(){

                ReadData('/MenuGroup/GetAll', null, function(res){

                    $.each(res, function(i,item){
                        TemplateEngine.RenderTo($('#tblRow'), item, $('#tbl tbody'));
                    });

                    // Düzenle butonuna tıklanınca modalı aç ve ilgili alanları doldur
                    $('.edit-menu-btn').on('click', function () {
                        var btn = $(this);
                        $('#menuText').val(btn.data('name'));
                        $('#menuIcon').val(''); // Menü grubu için ikon yoksa boş bırak
                        $('#menuKey').val(btn.data('id'));
                        $('#isNewMenu').prop('checked', btn.data('aktif') === true || btn.data('aktif') === 'True');
                        var modal = new bootstrap.Modal(document.getElementById('editMenuModal'));
                        modal.show();
                    });

                });

                // page.tbl = new DataTable('#tbl', {
                //     //  fixedColumns: true,
                //     //  fixedColumns: {
                //     //      start: 4
                //     //  },
                //     paging: false,
                //     scrollCollapse: true,
                //     scrollY: '770px',
                //     scrollX: true,
                //     order: []
                // });

            }

        };


        $(document)

        .ready(function () {

            page.ready();

        })

        ;

    </script>

    <script type="text/javascript">
        $(document).ready(function () {

            // Kaydet butonuna tıklanınca
            $('#saveMenuBtn').on('click', function () {
                // Burada formdan verileri alıp backend'e gönderebilirsiniz
                var data = {
                    menuText: $('#menuText').val(),
                    menuIcon: $('#menuIcon').val(),
                    menuKey: $('#menuKey').val(),
                    isNew: $('#isNewMenu').is(':checked')
                };
                console.log('Kaydedilecek veri:', data);
                // Modalı kapat
                var modal = bootstrap.Modal.getInstance(document.getElementById('editMenuModal'));
                modal.hide();
            });
        });
    </script>

}